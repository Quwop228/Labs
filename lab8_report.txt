Лабораторная работа №8
дисциплина: «Управление данными»
тема: «Основные понятия Django. Вывод данных»
Вариант №6

Ход работы

Установим проект Django с помощью команды:

pip install django --user

Создадим проект samplesite с помощью команды

django-admin startproject samplesite

Рис. 1. Установленные файлы

Запустим веб-сервер с помощью отладочной команды

python manage.py runserver

и перейдем по адресу http://localhost:8000/.

Рис. 2. Результат работы программы

Создадим приложение hr, выводящее список сотрудников отдела кадров.
Для этого в папке проекта выполним команду:

python manage.py startapp hr

Рис. 3. Созданные файлы

Зарегистрируем созданное приложение в проекте добавим в список
INSTALLED_APPS добавим строку

'hr.apps.HrConfig'

Напишем контроллер, который пока будет выводить только текст, что
будущие пользователи увидят на этой странице список сотрудников. Это будет
контроллер-функция. Изменим модуль views.py пакета приложения hr,
заменив имеющийся код следующим:

from django.http import HttpResponse

def index(req):
    return HttpResponse("Здесь будет выведен список сотрудников отдела кадров")

Свяжем интернет-адрес с созданным контроллером. Для этого добавим
в модуль проекта urls.py следующее:

from hr.views import index

и в список urlpatterns

path('hr/', index)

Запустим отладочный веб-сервер и перейдем по ссылке
localhost:8000/hr/.

Рис. 4. Результат работы программы

Для описания таблиц базы данных отдела кадров объявим модели в
модуле models.py. База данных состоит из 7 таблиц: Specialties (Специальности),
Positions (Должности), Employees (Сотрудники), Education (Образование),
Qualification_Training (Повышение квалификации), Rewards (Поощрения),
Penalties (Взыскания).

Объявим модель Specialty (Специальность):

class Specialty(models.Model):
    specialty_code = models.CharField(max_length=20, primary_key=True, verbose_name="Код специальности")
    specialty_name = models.CharField(max_length=200, verbose_name="Наименование специальности")

    class Meta:
        verbose_name = "Специальность"
        verbose_name_plural = "Специальности"

    def __str__(self):
        return f"{self.specialty_code} - {self.specialty_name}"

Объявим модель Position (Должность):

class Position(models.Model):
    position_code = models.CharField(max_length=10, primary_key=True, verbose_name="Код должности")
    position_name = models.CharField(max_length=100, verbose_name="Наименование должности")
    salary = models.DecimalField(max_digits=10, decimal_places=2, verbose_name="Должностной оклад")

    class Meta:
        verbose_name = "Должность"
        verbose_name_plural = "Должности"

    def __str__(self):
        return f"{self.position_code} - {self.position_name}"

Объявим модель Employee (Сотрудник):

class Employee(models.Model):
    full_name = models.CharField(max_length=200, verbose_name="ФИО сотрудника")
    passport_number = models.CharField(max_length=20, unique=True, verbose_name="Номер паспорта")
    birth_date = models.DateField(verbose_name="Дата рождения")
    home_address = models.TextField(null=True, blank=True, verbose_name="Домашний адрес")
    home_phone = models.CharField(max_length=20, null=True, blank=True, verbose_name="Домашний телефон")
    position = models.ForeignKey(
        Position,
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        verbose_name="Должность",
        related_name="employees"
    )

    class Meta:
        verbose_name = "Сотрудник"
        verbose_name_plural = "Сотрудники"

    def __str__(self):
        return self.full_name

Объявим модель Education (Образование):

class Education(models.Model):
    EDUCATION_LEVELS = [
        ('Среднее', 'Среднее'),
        ('Среднее специальное', 'Среднее специальное'),
        ('Неполное высшее', 'Неполное высшее'),
        ('Высшее', 'Высшее'),
        ('Магистратура', 'Магистратура'),
        ('Аспирантура', 'Аспирантура'),
    ]

    employee = models.ForeignKey(
        Employee,
        on_delete=models.CASCADE,
        verbose_name="Сотрудник",
        related_name="educations"
    )
    education_level = models.CharField(max_length=50, choices=EDUCATION_LEVELS, verbose_name="Уровень образования")
    diploma_number = models.CharField(max_length=50, unique=True, verbose_name="Номер диплома")
    specialty = models.ForeignKey(
        Specialty,
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        verbose_name="Специальность",
        related_name="educations"
    )
    qualification = models.CharField(max_length=100, null=True, blank=True, verbose_name="Квалификация")

    class Meta:
        verbose_name = "Образование"
        verbose_name_plural = "Образование"

    def __str__(self):
        return f"{self.employee.full_name} - {self.education_level} ({self.diploma_number})"

Объявим модель QualificationTraining (Повышение квалификации):

class QualificationTraining(models.Model):
    employee = models.ForeignKey(
        Employee,
        on_delete=models.CASCADE,
        verbose_name="Сотрудник",
        related_name="trainings"
    )
    training_date = models.DateField(verbose_name="Дата повышения квалификации")
    qualification_awarded = models.CharField(max_length=100, verbose_name="Присвоена квалификация")
    certificate_number = models.CharField(max_length=50, unique=True, verbose_name="Номер свидетельства")

    class Meta:
        verbose_name = "Повышение квалификации"
        verbose_name_plural = "Повышение квалификации"

    def __str__(self):
        return f"{self.employee.full_name} - {self.qualification_awarded}"

Объявим модель Reward (Поощрение):

class Reward(models.Model):
    employee = models.ForeignKey(
        Employee,
        on_delete=models.CASCADE,
        verbose_name="Сотрудник",
        related_name="rewards"
    )
    reward_date = models.DateField(verbose_name="Дата поощрения")
    reward_type = models.CharField(max_length=100, verbose_name="Вид поощрения")

    class Meta:
        verbose_name = "Поощрение"
        verbose_name_plural = "Поощрения"

    def __str__(self):
        return f"{self.employee.full_name} - {self.reward_type}"

Объявим модель Penalty (Взыскание):

class Penalty(models.Model):
    employee = models.ForeignKey(
        Employee,
        on_delete=models.CASCADE,
        verbose_name="Сотрудник",
        related_name="penalties"
    )
    penalty_date = models.DateField(verbose_name="Дата взыскания")
    penalty_type = models.CharField(max_length=100, verbose_name="Вид взыскания")

    class Meta:
        verbose_name = "Взыскание"
        verbose_name_plural = "Взыскания"

    def __str__(self):
        return f"{self.employee.full_name} - {self.penalty_type}"

Сгенерируем миграцию на основе созданных моделей и проверим
sql-код, созданный миграцией с помощью команд:

python manage.py makemigrations hr
python manage.py sqlmigrate hr 0001

Результат:

BEGIN;
--
-- Create model Employee
--
CREATE TABLE "hr_employee" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "full_name" varchar(200) NOT NULL, "passport_number" varchar(20) NOT NULL UNIQUE, "birth_date" date NOT NULL, "home_address" text NULL, "home_phone" varchar(20) NULL);
--
-- Create model Position
--
CREATE TABLE "hr_position" ("position_code" varchar(10) NOT NULL PRIMARY KEY, "position_name" varchar(100) NOT NULL, "salary" decimal NOT NULL);
--
-- Create model Specialty
--
CREATE TABLE "hr_specialty" ("specialty_code" varchar(20) NOT NULL PRIMARY KEY, "specialty_name" varchar(200) NOT NULL);
--
-- Create model Penalty
--
CREATE TABLE "hr_penalty" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "penalty_date" date NOT NULL, "penalty_type" varchar(100) NOT NULL, "employee_id" bigint NOT NULL REFERENCES "hr_employee" ("id") DEFERRABLE INITIALLY DEFERRED);
--
-- Add field position to employee
--
ALTER TABLE "hr_employee" ADD COLUMN "position_id" varchar(10) NULL REFERENCES "hr_position" ("position_code") DEFERRABLE INITIALLY DEFERRED;
--
-- Create model QualificationTraining
--
CREATE TABLE "hr_qualificationtraining" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "training_date" date NOT NULL, "qualification_awarded" varchar(100) NOT NULL, "certificate_number" varchar(50) NOT NULL UNIQUE, "employee_id" bigint NOT NULL REFERENCES "hr_employee" ("id") DEFERRABLE INITIALLY DEFERRED);
--
-- Create model Reward
--
CREATE TABLE "hr_reward" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "reward_date" date NOT NULL, "reward_type" varchar(100) NOT NULL, "employee_id" bigint NOT NULL REFERENCES "hr_employee" ("id") DEFERRABLE INITIALLY DEFERRED);
--
-- Create model Education
--
CREATE TABLE "hr_education" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "education_level" varchar(50) NOT NULL, "diploma_number" varchar(50) NOT NULL UNIQUE, "qualification" varchar(100) NULL, "employee_id" bigint NOT NULL REFERENCES "hr_employee" ("id") DEFERRABLE INITIALLY DEFERRED, "specialty_id" varchar(20) NULL REFERENCES "hr_specialty" ("specialty_code") DEFERRABLE INITIALLY DEFERRED);
CREATE INDEX "hr_penalty_employee_id_c1672a80" ON "hr_penalty" ("employee_id");
CREATE INDEX "hr_employee_position_id_1ab56386" ON "hr_employee" ("position_id");
CREATE INDEX "hr_qualificationtraining_employee_id_f3f15dab" ON "hr_qualificationtraining" ("employee_id");
CREATE INDEX "hr_reward_employee_id_a987a70b" ON "hr_reward" ("employee_id");
CREATE INDEX "hr_education_employee_id_e2ebc41b" ON "hr_education" ("employee_id");
CREATE INDEX "hr_education_specialty_id_e8695a0e" ON "hr_education" ("specialty_id");
COMMIT;

Затем выполним миграцию с помощью команды

python manage.py migrate

Рис. 5. Результат выполнения команды

Создадим записи в справочнике специальностей через консоль:

>>> from hr.models import Specialty, Position, Employee, Education, QualificationTraining, Reward, Penalty
>>> Specialty.objects.create(specialty_code='09.03.01', specialty_name='Информатика и вычислительная техника')
>>> Specialty.objects.create(specialty_code='38.03.01', specialty_name='Экономика')
>>> Specialty.objects.create(specialty_code='40.03.01', specialty_name='Юриспруденция')
>>> Specialty.objects.create(specialty_code='09.03.03', specialty_name='Прикладная информатика')
>>> Specialty.objects.create(specialty_code='38.03.02', specialty_name='Менеджмент')

Создадим записи в справочнике должностей:

>>> Position.objects.create(position_code='DIR', position_name='Директор', salary=150000.00)
>>> Position.objects.create(position_code='MGR', position_name='Менеджер', salary=80000.00)
>>> Position.objects.create(position_code='DEV', position_name='Разработчик', salary=95000.00)
>>> Position.objects.create(position_code='ACC', position_name='Бухгалтер', salary=70000.00)
>>> Position.objects.create(position_code='HR', position_name='Специалист по кадрам', salary=65000.00)
>>> Position.objects.create(position_code='LAW', position_name='Юрист', salary=75000.00)

Создадим экземпляр класса Employee и сохраним его в базу данных через
консоль:

>>> e1 = Employee(full_name='Иванов Иван Иванович', passport_number='4512 123456', birth_date='1985-03-15', home_address='г. Москва, ул. Ленина, д. 10, кв. 5', home_phone='+7-495-123-45-67', position=Position.objects.get(position_code='DIR'))
>>> e1.save()

Создадим еще одного сотрудника:

>>> e2 = Employee()
>>> e2.full_name = 'Петрова Мария Сергеевна'
>>> e2.passport_number = '4513 234567'
>>> e2.birth_date = '1990-07-22'
>>> e2.home_address = 'г. Москва, ул. Пушкина, д. 20, кв. 12'
>>> e2.home_phone = '+7-495-234-56-78'
>>> e2.position = Position.objects.get(position_code='MGR')
>>> e2.save()

Создадим остальных сотрудников с помощью атрибута класса objects и метода
create().

>>> Employee.objects.create(full_name='Сидоров Петр Алексеевич', passport_number='4514 345678', birth_date='1988-11-30', home_address='г. Москва, ул. Гоголя, д. 15, кв. 8', home_phone='+7-495-345-67-89', position=Position.objects.get(position_code='DEV'))
>>> Employee.objects.create(full_name='Козлова Анна Дмитриевна', passport_number='4515 456789', birth_date='1992-05-18', home_address='г. Москва, ул. Чехова, д. 25, кв. 3', home_phone='+7-495-456-78-90', position=Position.objects.get(position_code='ACC'))
>>> Employee.objects.create(full_name='Смирнов Алексей Викторович', passport_number='4516 567890', birth_date='1987-09-10', home_address='г. Москва, ул. Толстого, д. 30, кв. 15', home_phone='+7-495-567-89-01', position=Position.objects.get(position_code='DEV'))
>>> Employee.objects.create(full_name='Новикова Елена Павловна', passport_number='4517 678901', birth_date='1995-02-28', home_address='г. Москва, ул. Достоевского, д. 5, кв. 7', home_phone='+7-495-678-90-12', position=Position.objects.get(position_code='HR'))

Добавим записи об образовании:

>>> Education.objects.create(employee=Employee.objects.get(id=1), education_level='Высшее', diploma_number='ВСГ 1234567', specialty=Specialty.objects.get(specialty_code='38.03.02'), qualification='Менеджер')
>>> Education.objects.create(employee=Employee.objects.get(id=2), education_level='Высшее', diploma_number='ВСГ 2345678', specialty=Specialty.objects.get(specialty_code='38.03.01'), qualification='Экономист')
>>> Education.objects.create(employee=Employee.objects.get(id=3), education_level='Высшее', diploma_number='ВСГ 3456789', specialty=Specialty.objects.get(specialty_code='09.03.01'), qualification='Инженер-программист')
>>> Education.objects.create(employee=Employee.objects.get(id=3), education_level='Магистратура', diploma_number='ВМА 1111111', specialty=Specialty.objects.get(specialty_code='09.03.03'), qualification='Магистр прикладной информатики')
>>> Education.objects.create(employee=Employee.objects.get(id=4), education_level='Высшее', diploma_number='ВСГ 4567890', specialty=Specialty.objects.get(specialty_code='38.03.01'), qualification='Экономист-бухгалтер')
>>> Education.objects.create(employee=Employee.objects.get(id=5), education_level='Высшее', diploma_number='ВСГ 5678901', specialty=Specialty.objects.get(specialty_code='09.03.01'), qualification='Инженер-программист')
>>> Education.objects.create(employee=Employee.objects.get(id=6), education_level='Высшее', diploma_number='ВСГ 6789012', specialty=Specialty.objects.get(specialty_code='38.03.02'), qualification='Менеджер по персоналу')

Добавим записи о повышении квалификации:

>>> QualificationTraining.objects.create(employee=Employee.objects.get(id=1), training_date='2023-06-15', qualification_awarded='Управление проектами', certificate_number='ПК-2023-001')
>>> QualificationTraining.objects.create(employee=Employee.objects.get(id=2), training_date='2023-09-20', qualification_awarded='Финансовый анализ', certificate_number='ПК-2023-002')
>>> QualificationTraining.objects.create(employee=Employee.objects.get(id=3), training_date='2024-01-10', qualification_awarded='Современные технологии разработки ПО', certificate_number='ПК-2024-001')
>>> QualificationTraining.objects.create(employee=Employee.objects.get(id=5), training_date='2024-03-15', qualification_awarded='Архитектура микросервисов', certificate_number='ПК-2024-002')

Добавим поощрения:

>>> Reward.objects.create(employee=Employee.objects.get(id=1), reward_date='2023-12-25', reward_type='Премия за выполнение годового плана')
>>> Reward.objects.create(employee=Employee.objects.get(id=3), reward_date='2024-03-08', reward_type='Благодарность за успешную реализацию проекта')
>>> Reward.objects.create(employee=Employee.objects.get(id=2), reward_date='2024-05-01', reward_type='Премия ко Дню труда')
>>> Reward.objects.create(employee=Employee.objects.get(id=5), reward_date='2024-06-15', reward_type='Благодарность за наставничество')

Добавим взыскания:

>>> Penalty.objects.create(employee=Employee.objects.get(id=4), penalty_date='2024-02-10', penalty_type='Замечание за опоздание')
>>> Penalty.objects.create(employee=Employee.objects.get(id=6), penalty_date='2024-04-20', penalty_type='Выговор за нарушение трудовой дисциплины')

Выведем всех сотрудников.

Рис. 6. Результат работы программы

Отсортируем записи модели по полю full_name.

Рис. 7. Результат работы программы

Извлечем сотрудников, которые работают на должности разработчика.

Рис. 8. Результат работы программы

Отыщем сотрудника под номером 3.

Рис. 9. Результат работы программы

Удалим этот объект.

Рис. 10. Результат работы программы

Изменим контроллер index() так, чтобы он выводил список сотрудников,
отсортированный по ФИО.

from django.http import HttpResponse
from hr.models import Employee

def index(req):
    s = "Список сотрудников отдела кадров:<br><br>"
    for emp in Employee.objects.select_related('position').order_by('full_name'):
        position_name = emp.position.position_name if emp.position else "Не назначена"
        salary = emp.position.salary if emp.position else "-"
        s += f"{emp.full_name} - {position_name} (оклад: {salary} руб.)<br>"
    return HttpResponse(s)

Рис. 11. Результат работы программы
